import{U as g}from"./Icon-777631f3.js";import{u as A}from"./ToolTip-7f37fa70.js";import{a as c,o as u,b as l,d as m,t as B,i as p,A as f,w as S,E as _,B as T,L as I,n as b,F as U,j as C,g as y,e as k}from"./vue.esm-bundler-afa73d68.js";import{_ as v}from"./_plugin-vue_export-helper-c27b6911.js";const M={components:{UnnnicIcon:g,UnnnicToolTip:A},props:{isRecording:{type:Boolean,default:!1},time:{type:String,default:""}},methods:{save(){this.$emit("save")}}},D={class:"audio-handler"},L={class:"audio-handler__time"};function E(e,a,s,o,r,t){const d=c("unnnic-icon"),n=c("unnnic-tool-tip");return u(),l("div",D,[m("div",null,[m("span",L,B(s.time),1),p(d,{icon:"indicator",size:"sm",class:f([{"is-recording":s.isRecording}]),scheme:s.isRecording?null:"neutral-clean"},null,8,["class","scheme"])]),p(n,{enabled:"",text:"Salvar",side:"top"},{default:S(()=>[m("span",{onClick:a[0]||(a[0]=(...i)=>t.save&&t.save(...i)),onKeypress:a[1]||(a[1]=_((...i)=>t.save&&t.save(...i),["enter"])),class:"unnnic--clickable"},[p(d,{icon:"check-circle-1-1",scheme:"feedback-green"})],32)],void 0),_:1})])}const V=v(M,[["render",E],["__scopeId","data-v-7b03005d"]]);M.__docgenInfo={exportName:"default",displayName:"AudioHandler",description:"",tags:{},props:[{name:"isRecording",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"time",type:{name:"string"},defaultValue:{func:!1,value:"''"}}],events:[{name:"save"}],sourceFiles:["C:/Users/anacl/Documents/WENI/Front/unnnic/src/components/AudioRecorder/AudioHandler.vue"]};const R={components:{UnnnicIcon:g},props:{time:{type:String,default:""},duration:{type:String,default:""},reqStatus:{type:String,default:"default",validate(e){return["default","sending","failed"].includes(e)}},isPlaying:{type:Boolean,default:!1},progressBarPercentualValue:{type:Number,default:0},bars:{type:Array}},data(){return{progress:0}},methods:{click(){this.reqStatus==="failed"?this.$emit("failed-click"):this.reqStatus!=="sending"&&this.togglePlayback()},togglePlayback(){this[this.isPlaying?"pause":"play"]()},play(){this.$emit("play")},pause(){this.$emit("pause")},emitProgressBarUpdate(e){this.$emit("progress-bar-update",e)},isBarActive(e){return this.progressBarPercentualValue/100*22>e}},computed:{showProgressBar(){return!this.bars||this.bars.length===0},playbackIcon(){const e={sending:"loading-circle-1",failed:"upload-bottom-1"};return this.reqStatus in e?e[this.reqStatus]:this.isPlaying?"controls-pause-1":"controls-play-1"},progressBarStyle(){return{"--progressBarPercentualValue":`${this.progress}%`}}},watch:{progressBarPercentualValue(e){this.progress=e}}},x={class:"audio-player"},N=["max"],q={key:1,class:"audio-player__progress-bar-bars"},F={class:"audio-player__time"};function H(e,a,s,o,r,t){const d=c("unnnic-icon");return u(),l("div",x,[m("span",{onClick:a[0]||(a[0]=(...n)=>t.click&&t.click(...n)),onKeypress:a[1]||(a[1]=_((...n)=>t.click&&t.click(...n),["enter"])),class:f(["unnnic--clickable",{inactive:s.reqStatus==="sending"}])},[p(d,{icon:t.playbackIcon,scheme:"neutral-darkest"},null,8,["icon"])],34),t.showProgressBar?T((u(),l("input",{key:0,class:f(["audio-player__progress-bar unnnic--clickable",{inactive:s.reqStatus!=="default"}]),type:"range",min:"0",max:s.duration,step:"0.001","onUpdate:modelValue":a[2]||(a[2]=n=>r.progress=n),onInput:a[3]||(a[3]=(...n)=>t.emitProgressBarUpdate&&t.emitProgressBarUpdate(...n)),style:b(t.progressBarStyle)},null,46,N)),[[I,r.progress]]):(u(),l("div",q,[(u(!0),l(U,null,C(s.bars,(n,i)=>(u(),l("div",{key:i,style:b({height:`${n*100}%`}),class:f(["bar",{active:t.isBarActive(i)}])},null,6))),128))])),m("span",F,B(s.time),1)])}const z=v(R,[["render",H],["__scopeId","data-v-f05651a1"]]);R.__docgenInfo={exportName:"default",displayName:"AudioPlayer",description:"",tags:{},props:[{name:"time",type:{name:"string"},defaultValue:{func:!1,value:"''"}},{name:"duration",type:{name:"string"},defaultValue:{func:!1,value:"''"}},{name:"reqStatus",type:{name:"string"},defaultValue:{func:!1,value:"'default'"}},{name:"isPlaying",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"progressBarPercentualValue",type:{name:"number"},defaultValue:{func:!1,value:"0"}},{name:"bars",type:{name:"array"}}],events:[{name:"failed-click"},{name:"play"},{name:"pause"},{name:"progress-bar-update",type:{names:["undefined"]}}],sourceFiles:["C:/Users/anacl/Documents/WENI/Front/unnnic/src/components/AudioRecorder/AudioPlayer.vue"]};const K=e=>{const a=e.getChannelData(0),s=22,o=Math.floor(a.length/s),r=[];for(let t=0;t<s;t+=1){const d=o*t;let n=0;for(let i=0;i<o;i+=1)n+=Math.abs(a[d+i]);r.push(n/o)}return r},j=e=>{const a=Math.pow(Math.max(...e),-1);return e.map(s=>s*a)},P={name:"AudioRecorder",components:{AudioHandler:V,AudioPlayer:z,UnnnicIcon:g,UnnnicToolTip:A},props:{value:{type:HTMLAudioElement},src:{type:String},canDiscard:{type:Boolean,default:!0},reqStatus:{type:String,default:"default",validate(e){return["default","sending","failed"].includes(e)}},playbackAudioBars:{type:Boolean,default:!1}},data:()=>({recorder:null,audio:null,stream:null,audioChunks:[],duration:0,currentTime:0,mockMilliseconds:0,intervalMockMilliseconds:null,status:"idle",bars:[]}),computed:{isIdle(){return this.status==="idle"},isPlaying(){return this.status==="playing"},isRecording(){return this.status==="recording"},isRecorded(){return this.status==="recorded"},playedPercentual(){return this.currentTime*100/this.duration}},watch:{src:{immediate:!0,async handler(){this.src&&(this.audio=new Audio,this.audio.setAttribute("src",this.src),this.addAudioEventListeners())}},status(e){this.$emit("status",e)}},methods:{async record(){this.hasInUseRecordDevice()||(this.discard(),await this.getAudioRecordDevice(),this.setupRecorderAndAudio(),this.addListeners(),this.startRecord())},hasInUseRecordDevice(){return!!this.recorder},async getAudioRecordDevice(){this.stream=await navigator.mediaDevices.getUserMedia({audio:!0}),this.recorder=new MediaRecorder(this.stream)},async setupRecorderAndAudio(){this.audio=new Audio,this.audioChunks=[],this.duration=0,this.currentTime=0},addListeners(){this.recorder.addEventListener("dataavailable",e=>{this.audioChunks.push(e.data);const a=new Blob(this.audioChunks),s=URL.createObjectURL(a);this.audio.src=s,this.audio.currentTime=1e100}),this.recorder.addEventListener("stop",()=>{this.stream.getTracks().forEach(e=>{e.stop()}),this.recorder=null}),this.addAudioEventListeners()},addAudioEventListeners(){const e=()=>{this.audio.duration!==1/0&&(this.audio.currentTime=0,this.duration=this.audio.duration)};this.audio.addEventListener("loadeddata",e),this.audio.addEventListener("durationchange",e),this.audio.addEventListener("play",()=>{this.status="playing"}),this.audio.addEventListener("pause",()=>{this.status="paused"}),this.audio.addEventListener("timeupdate",()=>{this.status==="playing"&&(this.currentTime=this.audio.currentTime)}),this.audio.addEventListener("ended",()=>{this.currentTime=0,this.status="recorded"})},startMockMilliseconds(){this.intervalMockMilliseconds=setInterval(()=>{this.mockMilliseconds+=1,this.mockMilliseconds>=100&&(this.mockMilliseconds=0)},10)},stopMockMilliseconds(){clearInterval(this.intervalMockMilliseconds)},startRecord(){this.status="recording";const e=500;this.recorder.start(e),this.startMockMilliseconds()},discard(){this.audio&&this.stop(),this.$emit("input",null),this.status="idle"},save(){this.stop(),this.status="recorded",this.stopMockMilliseconds()},pause(){this.audio.pause()},async stop(){this.status="recorded",this.pause(),this.hasInUseRecordDevice()&&this.recorder.stop(),this.$emit("input",this.audio),this.stopMockMilliseconds()},play(){this.audio.play()},progressBarUpdate(e){if(this.audio){const{audio:a}=this;a.currentTime=e.target.value*a.duration/100}},async srcToBars(e){window.AudioContext=window.AudioContext||window.webkitAudioContext;const a=new AudioContext,o=await(await fetch(e)).arrayBuffer(),r=await a.decodeAudioData(o);return j(K(r))},numberToTimeString(e){const{isRecording:a}=this;function s(d,n=2){return d.toString().padStart(n,"0")}const o=s(Math.floor(e/60),a?2:1),r=s(Math.round(e%60)),t=s(this.mockMilliseconds);return`${o}:${r}${a?`:${t}`:""}`}}},W={key:0,class:"unnnic-audio-recorder"};function O(e,a,s,o,r,t){const d=c("unnnic-icon"),n=c("unnnic-tool-tip"),i=c("audio-handler"),w=c("audio-player");return s.value||t.isRecording||s.src?(u(),l("section",W,[t.isRecording||s.canDiscard?(u(),y(n,{key:0,enabled:"",text:"Descartar",side:"top"},{default:S(()=>[m("span",{onClick:a[0]||(a[0]=(...h)=>t.discard&&t.discard(...h)),onKeypress:a[1]||(a[1]=_((...h)=>t.discard&&t.discard(...h),["enter"])),class:"delete-button unnnic--clickable"},[p(d,{icon:"delete-1-1",scheme:"feedback-red"})],32)],void 0),_:1})):k("",!0),t.isRecording?(u(),y(i,{key:1,"is-recording":t.isRecording,time:t.numberToTimeString(e.duration),onSave:t.save},null,8,["is-recording","time","onSave"])):(u(),y(w,{key:2,time:t.numberToTimeString(t.isIdle||t.isRecorded?e.duration:e.currentTime),reqStatus:s.reqStatus,"progress-bar-percentual-value":t.playedPercentual,"is-playing":t.isPlaying,bars:s.playbackAudioBars?e.bars:null,onFailedClick:a[2]||(a[2]=h=>e.$emit("failed-click")),onPause:t.pause,onPlay:t.play,onProgressBarUpdate:t.progressBarUpdate},null,8,["time","reqStatus","progress-bar-percentual-value","is-playing","bars","onPause","onPlay","onProgressBarUpdate"]))])):k("",!0)}const Y=v(P,[["render",O],["__scopeId","data-v-b63defbf"]]);P.__docgenInfo={displayName:"AudioRecorder",exportName:"default",description:"",tags:{},props:[{name:"value",type:{name:"HTMLAudioElement"}},{name:"src",type:{name:"string"}},{name:"canDiscard",type:{name:"boolean"},defaultValue:{func:!1,value:"true"}},{name:"reqStatus",type:{name:"string"},defaultValue:{func:!1,value:"'default'"}},{name:"playbackAudioBars",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}}],events:[{name:"failed-click"},{name:"status",type:{names:["undefined"]}},{name:"input",type:{names:["undefined"]}}],sourceFiles:["C:/Users/anacl/Documents/WENI/Front/unnnic/src/components/AudioRecorder/AudioRecorder.vue"]};const Z=""+new URL("audio-recorder-sample-060b2498.mp3",import.meta.url).href;export{Z as A,Y as u};
//# sourceMappingURL=audio-recorder-sample-cd125c22.js.map
